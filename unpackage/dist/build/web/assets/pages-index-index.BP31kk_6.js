import{c as e,o as a,a as l,w as t,b as s,d as u,t as c,n as o,e as r,f as n,F as i,r as d,i as f,g as v,S as g,h as p,j as _,I as y,k,l as m,s as b,m as h,p as C}from"./index-CgsE51xo.js";import{f as w}from"./request.Dlmk2ZOF.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=x({__name:"plugin-card",props:{plugin:{type:Object,required:!0}},emits:["click"],setup(g,{emit:p}){const _=g,y=p,k=e((()=>_.plugin.verified?{type:"verified",query:"is:verified"}:_.plugin.insecure?{type:"insecure",query:"is:insecure"}:_.plugin.preview?{type:"preview",query:"is:preview"}:_.plugin.newborn?{type:"newborn",query:"is:newborn"}:_.plugin.portable?{type:"portable",query:"is:portable"}:null)),m=()=>{y("click",_.plugin)};return(e,p)=>{const _=f,y=v;return a(),l(y,{class:"plugin-card",onClick:m},{default:t((()=>[s(y,{class:"card-header"},{default:t((()=>[s(y,{class:"icon-container"},{default:t((()=>[s(y,{class:"category-icon"},{default:t((()=>[s(_,null,{default:t((()=>{return[u(c((e=g.plugin.category,{adapter:"ðŸ”Œ",extension:"ðŸ§©",tool:"ðŸ”§",game:"ðŸŽ®",image:"ðŸ–¼ï¸",manage:"âš™ï¸",general:"ðŸ“¦",preset:"ðŸ“‹",ai:"ðŸ¤–",gametool:"ðŸŽ¯",life:"ðŸŒŸ",media:"ðŸŽ¬",meme:"ðŸ˜„",webui:"ðŸŒ",core:"ðŸ’Ž",other:"ðŸ“„"}[e]||"ðŸ“¦")),1)];var e})),_:1})])),_:1})])),_:1}),s(y,{class:"header-main"},{default:t((()=>[s(y,{class:"title-row"},{default:t((()=>[s(_,{class:"plugin-name"},{default:t((()=>[u(c(g.plugin.shortname||g.plugin.name),1)])),_:1}),k.value?(a(),l(y,{key:0,class:o(["badge-icon",k.value.type])},{default:t((()=>[s(_,null,{default:t((()=>{return[u(c((e=k.value.type,{verified:"âœ“",preview:"ðŸ‘",insecure:"âš ",portable:"ðŸ“¦",newborn:"ðŸŽ‰"}[e]||"")),1)];var e})),_:1})])),_:1},8,["class"])):r("",!0)])),_:1}),s(y,{class:"rating-row"},{default:t((()=>[s(y,{class:"stars"},{default:t((()=>[(a(),n(i,null,d(5,(e=>s(_,{key:e,class:o(["star",{filled:e<=Math.round(g.plugin.rating||0)}])},{default:t((()=>[u("â˜…")])),_:2},1032,["class"]))),64))])),_:1}),s(_,{class:"rating-value"},{default:t((()=>[u(c((g.plugin.rating||0).toFixed(1)),1)])),_:1})])),_:1})])),_:1})])),_:1}),s(y,{class:"card-description"},{default:t((()=>[u(c(g.plugin.description),1)])),_:1}),s(y,{class:"card-footer"},{default:t((()=>[s(y,{class:"footer-item"},{default:t((()=>[s(_,{class:"footer-icon"},{default:t((()=>[u("ðŸ·ï¸")])),_:1}),s(_,{class:"footer-text"},{default:t((()=>[u(c(g.plugin.version),1)])),_:1})])),_:1}),g.plugin.installSize?(a(),l(y,{key:0,class:"footer-item"},{default:t((()=>[s(_,{class:"footer-icon"},{default:t((()=>[u("ðŸ“¦")])),_:1}),s(_,{class:"footer-text"},{default:t((()=>{return[u(c((e=g.plugin.installSize,e?e>=1048576e3?(e/1073741824).toFixed(1)+" GB":e>=1024e3?(e/1048576).toFixed(1)+" MB":(e/1024).toFixed(1)+" KB":"")),1)];var e})),_:1})])),_:1})):r("",!0),g.plugin.downloads?(a(),l(y,{key:1,class:"footer-item"},{default:t((()=>[s(_,{class:"footer-icon"},{default:t((()=>[u("ðŸ“¥")])),_:1}),s(_,{class:"footer-text"},{default:t((()=>[u(c(g.plugin.downloads),1)])),_:1})])),_:1})):r("",!0),s(y,{class:"spacer"}),s(y,{class:"author-avatar"},{default:t((()=>[s(_,{class:"avatar-text"},{default:t((()=>{return[u(c((e=g.plugin.author,e?e.charAt(0).toUpperCase():"?")),1)];var e})),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-b625390a"]]),V=x({__name:"market-sidebar",props:{collapsed:{type:Boolean,default:!1},marketInfo:{type:Object,default:()=>({})},sortOptions:{type:Array,required:!0},activeSort:{type:String,default:"default"},sortOrder:{type:String,default:"desc"},badges:{type:Array,required:!0},activeBadges:{type:Array,default:()=>[]},categories:{type:Array,required:!0},activeCategory:{type:String,default:""}},emits:["toggle","sort-change","badge-change","category-change"],setup(e,{emit:p}){const _=p,y=()=>{_("toggle")};return(p,k)=>{const m=f,b=v,h=g;return a(),l(b,{class:o(["sidebar",{collapsed:e.collapsed}])},{default:t((()=>[s(b,{class:"collapse-btn",onClick:y},{default:t((()=>[s(m,{class:"iconfont"},{default:t((()=>[u(c(e.collapsed?"â–º":"â—„"),1)])),_:1})])),_:1}),e.collapsed?r("",!0):(a(),l(h,{key:0,class:"sidebar-content","scroll-y":""},{default:t((()=>[s(b,{class:"filter-group"},{default:t((()=>[s(b,{class:"filter-title"},{default:t((()=>[u("æŽ’åºæ–¹å¼")])),_:1}),(a(!0),n(i,null,d(e.sortOptions,(n=>(a(),l(b,{key:n.key,class:o(["filter-item",{active:e.activeSort===n.key}]),onClick:e=>{return a=n.key,void _("sort-change",a);var a}},{default:t((()=>[s(m,{class:"filter-icon"},{default:t((()=>[u(c(n.icon),1)])),_:2},1024),s(m,{class:"filter-text"},{default:t((()=>[u(c(n.label),1)])),_:2},1024),s(b,{class:"spacer"}),e.activeSort===n.key?(a(),l(m,{key:0,class:"order-icon"},{default:t((()=>[u(c("desc"===e.sortOrder?"â†“":"â†‘"),1)])),_:1})):r("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1}),s(b,{class:"filter-group"},{default:t((()=>[s(b,{class:"filter-title"},{default:t((()=>[u("ç­›é€‰æ¡ä»¶")])),_:1}),(a(!0),n(i,null,d(e.badges,(r=>(a(),l(b,{key:r.key,class:o(["filter-item",{active:e.activeBadges.includes(r.key),[r.key]:!0}]),onClick:e=>{return a=r.key,void _("badge-change",a);var a}},{default:t((()=>[s(m,{class:"filter-icon"},{default:t((()=>[u(c(r.icon),1)])),_:2},1024),s(m,{class:"filter-text"},{default:t((()=>[u(c(r.label),1)])),_:2},1024),s(b,{class:"spacer"}),s(m,{class:"filter-count"},{default:t((()=>[u(c(r.count||0),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),s(b,{class:"filter-group"},{default:t((()=>[s(b,{class:"filter-title"},{default:t((()=>[u("æ’ä»¶åˆ†ç±»")])),_:1}),(a(!0),n(i,null,d(e.categories,(r=>(a(),l(b,{key:r.key,class:o(["filter-item",{active:e.activeCategory===r.key}]),onClick:e=>{return a=r.key,void _("category-change",a);var a}},{default:t((()=>[s(m,{class:"filter-icon"},{default:t((()=>[u(c(r.icon),1)])),_:2},1024),s(m,{class:"filter-text"},{default:t((()=>[u(c(r.label),1)])),_:2},1024),s(b,{class:"spacer"}),s(m,{class:"filter-count"},{default:t((()=>[u(c(r.count||0),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}))])),_:1},8,["class"])}}},[["__scopeId","data-v-079bf2f9"]]),q=x({__name:"search-header",props:{modelValue:{type:Array,default:()=>[]},placeholder:{type:String,default:"æœç´¢æ’ä»¶..."}},emits:["update:modelValue","search","clear"],setup(e,{emit:o}){const k=e,m=o,b=p(""),h=p([...k.modelValue]);_((()=>k.modelValue),(e=>{h.value=[...e]}),{deep:!0});const C=()=>{if(b.value.trim()){const e=[...h.value,b.value.trim()];h.value=e,m("update:modelValue",e),m("search",b.value.trim()),b.value=""}},w=()=>{b.value="",h.value=[],m("update:modelValue",[]),m("clear")};return(o,p)=>{const _=f,k=v,x=y,S=g;return a(),l(k,{class:"search-header"},{default:t((()=>[s(k,{class:"search-bar"},{default:t((()=>[s(k,{class:"search-icon"},{default:t((()=>[s(_,{class:"iconfont"},{default:t((()=>[u("ðŸ”")])),_:1})])),_:1}),s(x,{class:"search-input",type:"text",modelValue:b.value,"onUpdate:modelValue":p[0]||(p[0]=e=>b.value=e),placeholder:e.placeholder,"confirm-type":"search",onConfirm:C},null,8,["modelValue","placeholder"]),b.value?(a(),l(k,{key:0,class:"clear-icon",onClick:w},{default:t((()=>[s(_,{class:"iconfont"},{default:t((()=>[u("âœ•")])),_:1})])),_:1})):r("",!0)])),_:1}),h.value.length>0?(a(),l(S,{key:0,class:"search-tags","scroll-x":""},{default:t((()=>[s(k,{class:"tag-list"},{default:t((()=>[(a(!0),n(i,null,d(h.value,((e,o)=>(a(),l(k,{key:o,class:"search-tag",onClick:e=>(e=>{h.value.splice(e,1),m("update:modelValue",[...h.value])})(o)},{default:t((()=>[u(c(e)+" ",1),s(_,{class:"tag-close"},{default:t((()=>[u("âœ•")])),_:1})])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):r("",!0)])),_:1})}}},[["__scopeId","data-v-df3adbf7"]]),A=x({__name:"index",setup(_){const y=p([]),x=p(!1),A=p(!0),O=p(!1),T=p(null),B=p("default"),I=p("desc"),j=[{key:"default",label:"é»˜è®¤æŽ’åº",icon:"â­"},{key:"download",label:"ä¸‹è½½é‡",icon:"ðŸ“¥"},{key:"rating",label:"è¯„åˆ†",icon:"â¤ï¸"},{key:"updated",label:"æ›´æ–°æ—¶é—´",icon:"ðŸ•"},{key:"created",label:"å‘å¸ƒæ—¶é—´",icon:"ðŸ“…"}],F=p([]),D=p([{key:"verified",label:"å®˜æ–¹è®¤è¯",icon:"âœ“",count:0},{key:"preview",label:"é¢„è§ˆç‰ˆæœ¬",icon:"ðŸ‘",count:0},{key:"insecure",label:"ä¸å®‰å…¨",icon:"âš ",count:0},{key:"portable",label:"ä¾¿æºç‰ˆæœ¬",icon:"ðŸ“¦",count:0},{key:"newborn",label:"æ–°å‘å¸ƒ",icon:"ðŸŽ‰",count:0}]),E=p(""),L=p([{key:"adapter",label:"é€‚é…å™¨",icon:"ðŸ”Œ",count:0},{key:"extension",label:"æ‰©å±•åŠŸèƒ½",icon:"ðŸ§©",count:0},{key:"tool",label:"å®žç”¨å·¥å…·",icon:"ðŸ”§",count:0},{key:"game",label:"å¨±ä¹çŽ©æ³•",icon:"ðŸŽ®",count:0},{key:"image",label:"å›¾ç‰‡æœåŠ¡",icon:"ðŸ–¼",count:0},{key:"manage",label:"ç®¡ç†å·¥å…·",icon:"âš™ï¸",count:0},{key:"general",label:"é€šç”¨åŠŸèƒ½",icon:"ðŸ“¦",count:0},{key:"other",label:"å…¶ä»–",icon:"ðŸ“‹",count:0}]),U=p([]),M=p({}),z=p(1),K=p(24),$=e((()=>{let e=U.value;return y.value.length>0&&(e=e.filter((e=>y.value.every((a=>{const l=a.toLowerCase();return e.name.toLowerCase().includes(l)||e.description.toLowerCase().includes(l)||e.author.toLowerCase().includes(l)}))))),E.value&&(e=e.filter((e=>e.category===E.value))),F.value.length>0&&(e=e.filter((e=>F.value.every((a=>e[a]))))),e=[...e].sort(((e,a)=>{let l,t;switch(B.value){case"download":l=e.downloads||0,t=a.downloads||0;break;case"rating":l=e.rating||0,t=a.rating||0;break;case"updated":l=new Date(e.updatedAt||0).getTime(),t=new Date(a.updatedAt||0).getTime();break;case"created":l=new Date(e.createdAt||0).getTime(),t=new Date(a.createdAt||0).getTime();break;default:return 0}return"desc"===I.value?t-l:l-t})),e})),G=e((()=>Math.ceil($.value.length/K.value))),J=e((()=>{const e=(z.value-1)*K.value,a=e+K.value;return $.value.slice(e,a)})),N=()=>{x.value=!x.value},R=()=>{A.value=!A.value,h("theme",A.value?"dark":"light")},H=e=>{z.value=1},P=()=>{z.value=1},Q=e=>{B.value===e?I.value="desc"===I.value?"asc":"desc":(B.value=e,I.value="desc"),z.value=1},W=e=>{const a=F.value.indexOf(e);a>-1?F.value.splice(a,1):F.value.push(e),z.value=1},X=e=>{E.value===e?E.value="":E.value=e,z.value=1},Y=e=>{const a=encodeURIComponent(JSON.stringify(e));C({url:`/pages/plugin-detail/plugin-detail?plugin=${a}`})},Z=()=>{C({url:"/pages/settings/settings"})},ee=()=>{z.value>1&&z.value--},ae=()=>{z.value<G.value&&z.value++},le=async()=>{try{O.value=!0,T.value=null,console.log("å¼€å§‹åŠ è½½ Koishi æ’ä»¶å¸‚åœºæ•°æ®...");const e=await w({isConsoleOutput:!0,isShowToast:!0});console.log("æ•°æ®åŠ è½½æˆåŠŸ:",e),U.value=e.plugins||[],M.value={forceTime:e.forceTime,mirror:e.mirror,total:e.total},te(e),console.log(`æˆåŠŸåŠ è½½ ${U.value.length} ä¸ªæ’ä»¶`)}catch(e){console.error("åŠ è½½æ’ä»¶æ•°æ®å¤±è´¥:",e),T.value=e.message||"åŠ è½½å¤±è´¥",b({title:"åŠ è½½å¤±è´¥",content:"æ— æ³•åŠ è½½æ’ä»¶æ•°æ®ï¼Œè¯·ç¨åŽé‡è¯•",confirmText:"é‡è¯•",success:e=>{e.confirm&&le()}})}finally{O.value=!1}},te=e=>{e.badges&&D.value.forEach((a=>{a.count=e.badges[a.key]||0})),e.categories&&L.value.forEach((a=>{a.count=e.categories[a.key]||0})),e.badges&&e.categories||(D.value.forEach((e=>{e.count=U.value.filter((a=>a[e.key])).length})),L.value.forEach((e=>{e.count=U.value.filter((a=>a.category===e.key)).length})))},se=()=>{le()};return k((()=>{const e=m("theme");e&&(A.value="dark"===e),le()})),(e,p)=>{const _=f,k=v,m=g;return a(),l(k,{class:o(["market-page",{"dark-mode":A.value}])},{default:t((()=>[s(k,{class:"top-section"},{default:t((()=>[s(q,{modelValue:y.value,"onUpdate:modelValue":p[0]||(p[0]=e=>y.value=e),onSearch:H,onClear:P},null,8,["modelValue"]),M.value&&M.value.mirror?(a(),l(k,{key:0,class:"market-info"},{default:t((()=>[s(k,{class:"info-tag"},{default:t((()=>[s(_,{class:"info-icon"},{default:t((()=>[u("ðŸŒ")])),_:1}),s(_,{class:"info-label"},{default:t((()=>[u("é•œåƒæº:")])),_:1}),s(_,{class:"info-value"},{default:t((()=>[u(c(M.value.mirror),1)])),_:1})])),_:1}),s(k,{class:"info-tag"},{default:t((()=>[s(_,{class:"info-icon"},{default:t((()=>[u("ðŸ“¦")])),_:1}),s(_,{class:"info-label"},{default:t((()=>[u("æ’ä»¶æ€»æ•°:")])),_:1}),s(_,{class:"info-value"},{default:t((()=>[u(c(M.value.total),1)])),_:1})])),_:1})])),_:1})):r("",!0)])),_:1}),s(k,{class:"content"},{default:t((()=>[x.value?r("",!0):(a(),l(k,{key:0,class:"sidebar-mask",onClick:N})),s(V,{collapsed:x.value,"market-info":M.value,"sort-options":j,"active-sort":B.value,"sort-order":I.value,badges:D.value,"active-badges":F.value,categories:L.value,"active-category":E.value,onToggle:N,onSortChange:Q,onBadgeChange:W,onCategoryChange:X},null,8,["collapsed","market-info","active-sort","sort-order","badges","active-badges","categories","active-category"]),s(k,{class:o(["plugin-list",{"sidebar-collapsed":x.value}])},{default:t((()=>[s(k,{class:"result-header"},{default:t((()=>[s(k,{class:"header-actions"},{default:t((()=>[s(k,{class:"settings-btn",onClick:Z},{default:t((()=>[s(_,{class:"settings-icon"},{default:t((()=>[u("âš™ï¸")])),_:1}),s(_,{class:"settings-text"},{default:t((()=>[u("è®¾ç½®")])),_:1})])),_:1}),s(k,{class:"theme-toggle-btn",onClick:R},{default:t((()=>[s(_,{class:"theme-icon"},{default:t((()=>[u(c(A.value?"â˜€ï¸":"ðŸŒ™"),1)])),_:1}),s(_,{class:"theme-text"},{default:t((()=>[u(c(A.value?"æµ…è‰²":"æ·±è‰²"),1)])),_:1})])),_:1}),s(k,{class:o(["refresh-btn",{loading:O.value}]),onClick:se},{default:t((()=>[s(_,{class:"refresh-icon"},{default:t((()=>[u("ðŸ”„")])),_:1}),s(_,{class:"refresh-text"},{default:t((()=>[u(c(O.value?"åŠ è½½ä¸­...":"åˆ·æ–°"),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1}),O.value&&0===U.value.length?(a(),l(k,{key:0,class:"loading-state"},{default:t((()=>[s(k,{class:"loading-spinner"}),s(_,{class:"loading-text"},{default:t((()=>[u("æ­£åœ¨åŠ è½½æ’ä»¶æ•°æ®...")])),_:1})])),_:1})):(a(),l(m,{key:1,class:"plugin-scroll","scroll-y":""},{default:t((()=>[s(k,{class:"plugin-grid"},{default:t((()=>[(a(!0),n(i,null,d(J.value,(e=>(a(),l(S,{key:e.id,plugin:e,onClick:Y},null,8,["plugin"])))),128))])),_:1}),0===$.value.length?(a(),l(k,{key:0,class:"empty-state"},{default:t((()=>[s(_,{class:"empty-icon"},{default:t((()=>[u("ðŸ“¦")])),_:1}),s(_,{class:"empty-text"},{default:t((()=>[u("æ²¡æœ‰æ‰¾åˆ°ç›¸å…³æ’ä»¶")])),_:1})])),_:1})):r("",!0),G.value>1?(a(),l(k,{key:1,class:"pagination"},{default:t((()=>[s(k,{class:o(["page-btn",{disabled:1===z.value}]),onClick:ee},{default:t((()=>[u("ä¸Šä¸€é¡µ")])),_:1},8,["class"]),s(k,{class:"page-info"},{default:t((()=>[u(c(z.value)+" / "+c(G.value),1)])),_:1}),s(k,{class:o(["page-btn",{disabled:z.value===G.value}]),onClick:ae},{default:t((()=>[u("ä¸‹ä¸€é¡µ")])),_:1},8,["class"])])),_:1})):r("",!0)])),_:1}))])),_:1},8,["class"])])),_:1})])),_:1},8,["class"])}}},[["__scopeId","data-v-00d25f5f"]]);export{A as default};
