import{E as e,G as n,H as o,z as t,s as i,m as r}from"./index-fpvSXMFF.js";const a="https://sh-aliyun2.vincentzyu233.cn/koishi-market-proxy/market";function s(){return r("market_endpoint")||"https://sh-aliyun2.vincentzyu233.cn/koishi-market-proxy/market"}function l(r={}){const{endpoint:a=s(),isConsoleOutput:l=!0,isShowToast:p=!1,loadingText:g="加载插件数据中..."}=r;return l&&(console.log("-------[fetchMarketData]-------"),console.log("正在请求插件市场数据:",a),console.log("-------[fetchMarketData]-------")),new Promise(((r,s)=>{p&&e({title:g,mask:!0}),n({url:a,method:"GET",timeout:3e4,header:{"Content-Type":"application/json"},success:e=>{var n,i;if(l&&(console.log("-------[success]-------"),console.log("插件市场数据请求成功"),console.log("状态码:",e.statusCode),console.log("数据大小:",JSON.stringify(e.data).length,"bytes"),console.log("插件数量:",(null==(i=null==(n=e.data)?void 0:n.objects)?void 0:i.length)||0),console.log("-------[success]-------")),200!==e.statusCode)throw new Error(`HTTP ${e.statusCode}: 请求失败`);{const n=function(e){if(!e||!e.objects)return{forceTime:0,mirror:"",plugins:[],categories:{},badges:{}};const n=e.objects.map(((e,n)=>{var o,t,i,r,a,s;return{id:n+1,name:(null==(o=e.package)?void 0:o.name)||e.shortname||"unknown",shortname:e.shortname||"",version:(null==(t=e.package)?void 0:t.version)||"0.0.0",description:c(e),author:u(e),icon:"",category:e.category||"other",verified:e.verified||!1,preview:(null==(i=e.manifest)?void 0:i.preview)||!1,insecure:e.insecure||!1,portable:e.portable||!1,newborn:d(e.createdAt),ignored:e.ignored||!1,downloads:(null==(r=e.downloads)?void 0:r.lastMonth)||0,dependents:e.dependents||0,rating:e.rating||0,createdAt:e.createdAt||"",updatedAt:e.updatedAt||"",license:e.license||(null==(a=e.package)?void 0:a.license)||"",keywords:(null==(s=e.package)?void 0:s.keywords)||[],installSize:e.installSize||0,publishSize:e.publishSize||0,score:e.score||{},_raw:e}})),o={},t={verified:0,preview:0,insecure:0,portable:0,newborn:0};return n.forEach((e=>{o[e.category]=(o[e.category]||0)+1,e.verified&&t.verified++,e.preview&&t.preview++,e.insecure&&t.insecure++,e.portable&&t.portable++,e.newborn&&t.newborn++})),{forceTime:e.forceTime||0,mirror:e.mirror||"",plugins:n,categories:o,badges:t,total:n.length}}(e.data);p&&(o(),t({title:"加载完成",icon:"success",duration:1500})),r(n)}},fail:e=>{l&&(console.log("-------[fail]-------"),console.log("插件市场数据请求失败:",e),console.log("-------[fail]-------")),p&&o(),i({title:"加载失败",content:"无法获取插件市场数据，请检查网络连接",showCancel:!1}),s(e)}})}))}function c(e){var n,o;if(null==(n=e.manifest)?void 0:n.description){const n=e.manifest.description;return n.zh||n.en||n}return(null==(o=e.package)?void 0:o.description)||"暂无描述"}function u(e){var n,o,t,i,r,a,s;return(null==(o=null==(n=e.package)?void 0:n.publisher)?void 0:o.username)?e.package.publisher.username:(null==(r=null==(i=null==(t=e.package)?void 0:t.maintainers)?void 0:i[0])?void 0:r.username)?e.package.maintainers[0].username:(null==(s=null==(a=e.package)?void 0:a._npmUser)?void 0:s.name)?e.package._npmUser.name:"unknown"}function d(e){if(!e)return!1;const n=new Date(e).getTime();return Date.now()-n<2592e6}export{a as D,l as f,s as g};
